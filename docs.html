<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Dis: Managing the Underworld of Database Testing</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Documentation for Dis">
        <meta name="author" content="Joby Walker -- joby@imperium.org">

        <!-- CSS -->
        <link href="css/bootstrap.css" rel="stylesheet">
        <link href="css/prettify.css" rel="stylesheet">
        <style type="text/css">
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
            .docs-sidenav {
              width: 20%;
              background-color: #fff;
            }
            .docs-sidenav .icon-chevron-right {
              float: right;
              margin-top: 2px;
              margin-right: -6px;
              opacity: .25;
            }
            section {
                padding-top: 30px;
            }
            @media (max-width: 767px) {
                .docs-sidenav.affix {
                    position: static;
                }
                .docs-sidenav {
                    width: 95%;
                }
                section {
                    padding-top: 10px;
                }
          }
        </style>
        <link href="css/bootstrap-responsive.css" rel="stylesheet">

        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- Fav and touch icons -->
<!--
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
          <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
                        <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
                                       <link rel="shortcut icon" href="../assets/ico/favicon.png">
-->
  </head>

  <body data-spy="scroll" data-target=".docs-sidebar" data-offset="30">

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="index.html">Dis</a>
          <div class="x-nav-collapse x-collapse">
            <ul class="nav">
              <!-- <li><a href="index.html">Home</a></li> -->
              <!-- <li><a href="#about">About</a></li> -->
              <li class="active"><a href="./docs.html">Documentation</a></li>
              <!-- <li><a href="#contact">Examples</a></li> -->
<!--
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="#">Action</a></li>
                  <li><a href="#">Another action</a></li>
                  <li><a href="#">Something else here</a></li>
                  <li class="divider"></li>
                  <li class="nav-header">Nav header</li>
                  <li><a href="#">Separated link</a></li>
                  <li><a href="#">One more separated link</a></li>
                </ul>
              </li>
-->
            </ul>
<!--
            <form class="navbar-form pull-right">
              <input class="span2" type="text" placeholder="Email">
              <input class="span2" type="password" placeholder="Password">
              <button type="submit" class="btn">Sign in</button>
            </form>
-->
          </div><!--/.x-nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">

        <div class="row-fluid">
            <div class="span3 docs-sidebar">
                <ul class="nav nav-list docs-sidenav" data-spy="affix">
                    <li class="nav-header">Writing Tests
                    <li class="active"><a href="#schema"><i class="icon-chevron-right"></i>Schema</a>
                    <li><a href="#tests"><i class="icon-chevron-right"></i>Test</a>
                    <li class="nav-header">Running Tests
                    <li><a href="#list"><i class="icon-chevron-right"></i> List</a>
                    <li><a href="#single"><i class="icon-chevron-right"></i> Single</a>
                    <li><a href="#multiple"><i class="icon-chevron-right"></i> Multiple</a>
                    <li class="nav-header">Reports
                    <li><a href="#summary"><i class="icon-chevron-right"></i> Summaries</a>
                    <li><a href="#history"><i class="icon-chevron-right"></i> History</a>
                    <li><a href="#xml"><i class="icon-chevron-right"></i> XML</a>
                    <li class="nav-header">Assertions
                    <li><a href="#faux"><i class="icon-chevron-right"></i> Faux</a>
                    <li><a href="#same"><i class="icon-chevron-right"></i> Same</a>
                    <li><a href="#relative"><i class="icon-chevron-right"></i> Relative</a>
                    <li><a href="#array"><i class="icon-chevron-right"></i> Array</a>
                    <li><a href="#match"><i class="icon-chevron-right"></i> Match</a>
                    <li><a href="#type"><i class="icon-chevron-right"></i> Type</a>
                    <li><a href="#compare"><i class="icon-chevron-right"></i> Compare</a>
                    <li><a href="#raises"><i class="icon-chevron-right"></i> Raises</a>
                    <li><a href="#result"><i class="icon-chevron-right"></i> Result</a>
                    <!-- <li><a href="#"><i class="icon-chevron-right"></i> </a> -->
                </ul>
            </div>


            <div class="span9">
<!--
                <section id="">
                    <div class="page-header"><h1></h1></div>
                    <p></p>
<pre class="prettyprint linenums">
</pre>
                </section>
 -->
<section>
    <div class="page-header"><h1>Writing Tests</h1></div>
</section>
<section id="schema">
    <div class="page-header"><h2>Create Test Schema</h2></div>
    <p>All of your tests must be in a schema with a name ending with <code>_test</code>.  This is required so that the <code>dis.test</code> view can find all the the tests, but is also is good practice to group and isolate</p>
<pre class="prettyprint linenums">
CREATE SCHEMA myapp_test;
</pre>
</section>

<section id="tests">
    <div class="page-header"><h2>Example Test</h2></div>
    <p>This is an example test:</p>
<pre class="prettyprint linenums">
CREATE OR REPLACE FUNCTION myapp_test.test_alpha() RETURNS void
    LANGUAGE plpgsql
    VOLATILE
    SECURITY INVOKER
    AS $_$
-- module: example
-- submodule: basic
-- plan: 3
DECLARE
    _scores   dis.score[];
BEGIN
    _scores := ARRAY[
        dis.assert(TRUE, 'This is a test'),
        dis.assert(FALSE, 'Oops this will fail'),
        dis.assert(TRUE, 'This also works')
    ];
    PERFORM dis.tally(_scores);
END;
$_$;
</pre>
<p>
<ul>
    <li>(Line 1) Create the function in the <code>*_test</code> schema
    <li>(Line 1) The test name should start with <code>test_</code>
    <li>(Line 1) Since all tests should return exceptions the return type doesn't matter but <code>void</code> is a good default
    <li>(Line 3) Tests should be <code>VOLATILE</code> (which is the default) to ensure that they are always run.
    <li>(Line 6) In a single line comment, declare the module.  This is just a grouping for the tests and is used for running and reporting results.
    <li>(Line 7) In a single line comment, declare the submodule.  This is just a sub grouping of module and is used for the same reasons.
    <li>(Line 8) In a single line comment, declare the plan.  This is the number of assertions made in the test.  If the number of assertions reported to <code>dis.tally</code> is different than the plan then an error is reported.
    <li>(Line 10) A variable of the type <code>dis.score[]</code>, which is used to collect the results of assertions (which return <code>dis.score</code>).
    <li>(Line 17) Pass the <code>dis.score[]</code> as a parameter to <code>dis.tally</code> to compute the result of the test.
</section>
<section>
    <div class="page-header"><h1>Running Tests</h1></div>
</section>
<section id="list">
<div class="page-header"><h2>List Tests</h2></div>
<p>List the tests visible to Dis by schema, module, submodule, and test name</p>
<pre class="prettyprint linenums">
SELECT * FROM dis.test order by schema, module, submodule, name;
</pre>
</section>
<section id="single">
<div class="page-header"><h2>Run One Test</h2></div>
<p></p>
<pre class="prettyprint linenums">
SELECT dis.run_test('myapp_test', 'test_alpha');
-- the '_test' suffix and 'test_' prefix aren't necessary run_test will add them if not present
SELECT dis.run_test('myapp', 'alpha');
</pre>
</section>
<section id="multiple">
<div class="page-header"><h2>Run Multiple Tests</h2></div>
<p></p>
<pre class="prettyprint linenums">
-- run all tests
SELECT dis.run_tests();
-- run all tests in a schema (again the '_test' suffix is not required)
SELECT dis.run_tests('myapp');
-- run all tests in a schema module
SELECT dis.run_tests('myapp', 'example');
-- run all tests in a schema module submodule
SELECT dis.run_tests('myapp', 'example', 'basic');
</pre>
</section>
<section>
    <div class="page-header"><h1>Reporting</h1></div>
</section>
<section id="summary">
<div class="page-header"><h2>Result Summaries</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>

<section id="history">
<div class="page-header"><h2>Result History</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>

<section id="xml">
<div class="page-header"><h2>XML Reports</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>

<section>
    <div class="page-header"><h1>Assertions</h1></div>
</section>

<section id="faux">
<div class="page-header"><h2>Faux Assertions</h2></div>
<p>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras auctor sagittis urna id scelerisque. Nulla non nulla lacus. Suspendisse potenti. Phasellus tempor purus accumsan enim hendrerit imperdiet. Aliquam viverra, dolor ut fermentum venenatis, tortor enim facilisis sapien, in malesuada nisl erat at felis. Curabitur egestas interdum risus vel imperdiet. Aliquam erat volutpat. Curabitur in justo ante, sed convallis felis. Suspendisse dignissim ullamcorper nibh, vel pretium erat sodales a. Aliquam eleifend risus in augue rutrum ac interdum nibh porta. Etiam at felis risus. Integer luctus aliquam tincidunt. Vestibulum vitae ipsum sem.</p>

<p>Cras arcu purus, auctor ac auctor ut, varius at justo. Nam non felis vitae nunc fringilla dictum a a augue. Vivamus vitae tortor ante. Mauris lectus tortor, malesuada vel mollis imperdiet, aliquet non dolor. Curabitur nec risus leo, sit amet sagittis turpis. Cras et est et mi accumsan suscipit. Vestibulum ac consectetur augue. Integer purus nisl, sollicitudin eget egestas a, molestie sed lorem. Sed accumsan malesuada nunc, vel egestas ante malesuada sit amet.</p>
</section>

<section id="same">
<div class="page-header"><h2>Same Assertions</h2></div>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras auctor sagittis urna id scelerisque. Nulla non nulla lacus. Suspendisse potenti. Phasellus tempor purus accumsan enim hendrerit imperdiet. Aliquam viverra, dolor ut fermentum venenatis, tortor enim facilisis sapien, in malesuada nisl erat at felis. Curabitur egestas interdum risus vel imperdiet. Aliquam erat volutpat. Curabitur in justo ante, sed convallis felis. Suspendisse dignissim ullamcorper nibh, vel pretium erat sodales a. Aliquam eleifend risus in augue rutrum ac interdum nibh porta. Etiam at felis risus. Integer luctus aliquam tincidunt. Vestibulum vitae ipsum sem.</p>

<p>Cras arcu purus, auctor ac auctor ut, varius at justo. Nam non felis vitae nunc fringilla dictum a a augue. Vivamus vitae tortor ante. Mauris lectus tortor, malesuada vel mollis imperdiet, aliquet non dolor. Curabitur nec risus leo, sit amet sagittis turpis. Cras et est et mi accumsan suscipit. Vestibulum ac consectetur augue. Integer purus nisl, sollicitudin eget egestas a, molestie sed lorem. Sed accumsan malesuada nunc, vel egestas ante malesuada sit amet.</p>
</section>
<section id="relative">
<div class="page-header"><h2>Relative Assertions</h2></div>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras auctor sagittis urna id scelerisque. Nulla non nulla lacus. Suspendisse potenti. Phasellus tempor purus accumsan enim hendrerit imperdiet. Aliquam viverra, dolor ut fermentum venenatis, tortor enim facilisis sapien, in malesuada nisl erat at felis. Curabitur egestas interdum risus vel imperdiet. Aliquam erat volutpat. Curabitur in justo ante, sed convallis felis. Suspendisse dignissim ullamcorper nibh, vel pretium erat sodales a. Aliquam eleifend risus in augue rutrum ac interdum nibh porta. Etiam at felis risus. Integer luctus aliquam tincidunt. Vestibulum vitae ipsum sem.</p>

<p>Cras arcu purus, auctor ac auctor ut, varius at justo. Nam non felis vitae nunc fringilla dictum a a augue. Vivamus vitae tortor ante. Mauris lectus tortor, malesuada vel mollis imperdiet, aliquet non dolor. Curabitur nec risus leo, sit amet sagittis turpis. Cras et est et mi accumsan suscipit. Vestibulum ac consectetur augue. Integer purus nisl, sollicitudin eget egestas a, molestie sed lorem. Sed accumsan malesuada nunc, vel egestas ante malesuada sit amet.</p>
</section>

<section id="array">
<div class="page-header"><h2>Array Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>
<section id="match">
<div class="page-header"><h2>Match Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>
<section id="type">
<div class="page-header"><h2>Type Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>
<section id="compare">
<div class="page-header"><h2>Compare Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>
<section id="raises">
<div class="page-header"><h2>Raises Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>
<section id="result">
<div class="page-header"><h2>Result Assertions</h2></div>
<p></p>
<pre class="prettyprint linenums">
</pre>
</section>



            </div>

        </div><!-- row -->

      <hr>

      <footer>
        <p>&copy; Imperium.org 2012</p>
      </footer>

    </div> <!-- /container -->

    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/prettify.js"></script>
    <script>
        $(function(){
            prettyPrint();
        });
    </script>
  </body>
</html>
